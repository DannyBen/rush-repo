#!/usr/bin/env bash
echo "Identifying latest version"
version=$(curl -s https://api.github.com/repos/mikefarah/yq/releases/latest | grep "tag_name" | cut -d : -f 2,3 | tr -d \"\ ,v)

echo "Latest version is $version"

echo "Comparing with installed version (if any)"

installed() {
  hash yq 2> /dev/null && yq --version | grep "$version" > /dev/null 2>&1
}

if ! installed ; then
  echo "Downloading..."
  sudo curl -L "https://github.com/mikefarah/yq/releases/download/$version/yq_linux_amd64" -o /usr/local/bin/yq
  sudo chmod +x /usr/local/bin/yq
  echo "Installed in /usr/local/bin/yq"

else
  echo "Installed version is also $version - no update needed"

fi

yq --version
echo "Goodbye"